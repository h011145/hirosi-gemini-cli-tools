<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI対戦カードゲーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            max-width: 900px;
        }
        .card {
            width: 80px;
            height: 120px;
            background-color: #cbd5e0; /* Light gray for cards */
            color: #2d3748; /* Dark text on cards */
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            user-select: none; /* Prevent text selection */
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        .card.played {
            background-color: #4a5568; /* Darker gray for played cards */
            color: #a0aec0;
            cursor: default;
            transform: none;
            box-shadow: none;
        }
        .card.selected {
            border: 3px solid #63b3ed; /* Blue border for selected card */
            box-shadow: 0 0 15px rgba(99, 179, 237, 0.7);
        }
        .game-area {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            max-width: 600px;
            margin-top: 40px;
            margin-bottom: 40px;
            min-height: 150px; /* Ensure space for played cards */
        }
        .played-card {
            width: 100px;
            height: 150px;
            background-color: #a0aec0; /* Medium gray for played cards */
            color: #2d3748;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.3);
            margin: 0 20px;
        }
        .score-display {
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #4299e1; /* Blue button */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #3182ce; /* Darker blue on hover */
            transform: translateY(-1px);
        }
        button:disabled {
            background-color: #a0aec0; /* Gray when disabled */
            cursor: not-allowed;
            box-shadow: none;
        }
        .message {
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #f6ad55; /* Orange for messages */
        }
        .difficulty-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .difficulty-selector label {
            font-weight: bold;
        }
        .difficulty-selector select {
            padding: 8px 12px;
            border-radius: 6px;
            background-color: #2d3748;
            color: #e2e8f0;
            border: 1px solid #4a5568;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-100 p-5">

    <h1 class="text-4xl font-extrabold mb-8 text-blue-400">カードゲーム</h1>

    <div class="difficulty-selector">
        <label for="aiDifficulty" class="text-lg">AI難易度:</label>
        <select id="aiDifficulty" class="px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="random">ランダム (簡単)</option>
            <option value="strategic">戦略的 (普通)</option>
        </select>
    </div>

    <div class="score-display">
        <p class="text-xl">プレイヤー スコア: <span id="playerScore" class="text-green-400">0</span></p>
        <p class="text-xl">AI スコア: <span id="opponentScore" class="text-red-400">0</span></p>
    </div>

    <div class="game-area">
        <div class="flex flex-col items-center">
            <p class="text-lg mb-2">プレイヤーが出したカード</p>
            <div id="playerPlayedCard" class="played-card bg-blue-500 text-white rounded-xl shadow-lg">?</div>
        </div>
        <div class="flex flex-col items-center">
            <p class="text-lg mb-2">AIが出したカード</p>
            <div id="opponentPlayedCard" class="played-card bg-red-500 text-white rounded-xl shadow-lg">?</div>
        </div>
    </div>

    <div id="message" class="message text-orange-400">カードを選んで「カードを出す」ボタンを押してください。</div>

    <div class="card-container" id="playerHand">
        <!-- プレイヤーの手札がここに動的に追加されます -->
    </div>

    <div class="flex mt-8">
        <button id="playCardButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105">カードを出す</button>
        <button id="resetButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md ml-4 transition duration-200 ease-in-out transform hover:scale-105">リセット</button>
    </div>

    <script>
        const deck = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
        let playerHand = [];
        let opponentHand = [];
        let playerScore = 0;
        let opponentScore = 0;
        let selectedPlayerCard = null;
        let isGameActive = true; // ゲームが進行中かどうか
        let aiDifficulty = 'random'; // 'random' or 'strategic'

        // DOM要素の取得
        const playerHandContainer = document.getElementById('playerHand');
        const playerScoreDisplay = document.getElementById('playerScore');
        const opponentScoreDisplay = document.getElementById('opponentScore');
        const playerPlayedCardDisplay = document.getElementById('playerPlayedCard');
        const opponentPlayedCardDisplay = document.getElementById('opponentPlayedCard');
        const messageDisplay = document.getElementById('message');
        const playCardButton = document.getElementById('playCardButton');
        const resetButton = document.getElementById('resetButton');
        const aiDifficultySelector = document.getElementById('aiDifficulty');

        // 配列をシャッフルする関数 (Fisher-Yatesアルゴリズム)
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // ゲームの初期化
        function initializeGame() {
            playerHand = shuffle([...deck]); // デッキのコピーをシャッフル
            opponentHand = shuffle([...deck]); // AIも同じデッキで初期化
            playerScore = 0;
            opponentScore = 0;
            selectedPlayerCard = null;
            isGameActive = true;
            updateScores();
            renderPlayerHand();
            clearPlayedCards();
            messageDisplay.textContent = 'カードを選んで「カードを出す」ボタンを押してください。';
            playCardButton.disabled = false;
            resetButton.disabled = false;
            aiDifficulty = aiDifficultySelector.value; // 選択された難易度をセット
        }

        // プレイヤーの手札を表示
        function renderPlayerHand() {
            playerHandContainer.innerHTML = ''; // 既存のカードをクリア
            playerHand.forEach(cardValue => {
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('card', 'bg-gray-300', 'text-gray-800', 'rounded-lg', 'shadow-md', 'cursor-pointer', 'hover:bg-gray-200', 'transition', 'transform', 'hover:scale-105');
                cardDiv.textContent = cardValue;
                cardDiv.dataset.value = cardValue; // カードの値をデータ属性として保存

                cardDiv.addEventListener('click', () => {
                    if (!isGameActive) return; // ゲーム終了後は選択不可

                    // 既に選択されているカードがあれば、選択状態を解除
                    if (selectedPlayerCard) {
                        const prevSelected = playerHandContainer.querySelector(`.card[data-value="${selectedPlayerCard}"]`);
                        if (prevSelected) {
                            prevSelected.classList.remove('selected');
                        }
                    }
                    // 新しいカードを選択状態にする
                    selectedPlayerCard = cardValue;
                    cardDiv.classList.add('selected');
                    messageDisplay.textContent = `${cardValue} を選択しました。`;
                });
                playerHandContainer.appendChild(cardDiv);
            });
        }

        // スコア表示を更新
        function updateScores() {
            playerScoreDisplay.textContent = playerScore;
            opponentScoreDisplay.textContent = opponentScore;
        }

        // 場に出されたカードをクリア
        function clearPlayedCards() {
            playerPlayedCardDisplay.textContent = '?';
            opponentPlayedCardDisplay.textContent = '?';
            playerPlayedCardDisplay.classList.remove('text-green-400', 'text-red-400');
            opponentPlayedCardDisplay.classList.remove('text-green-400', 'text-red-400');
        }

        // AIのカード選択ロジック
        function getOpponentCard(playerCardValue, difficulty) {
            if (difficulty === 'random') {
                // ランダムAI: 手札からランダムに1枚選ぶ
                const randomIndex = Math.floor(Math.random() * opponentHand.length);
                return opponentHand.splice(randomIndex, 1)[0];
            } else if (difficulty === 'strategic') {
                // 戦略的AI: 勝利できる最小のカード、または負ける場合は最小のカード
                let winningCards = opponentHand.filter(card => card > playerCardValue);
                
                if (winningCards.length > 0) {
                    // 勝てるカードがある場合、その中で最小のカードを選ぶ
                    winningCards.sort((a, b) => a - b);
                    const chosenCard = winningCards[0];
                    const index = opponentHand.indexOf(chosenCard);
                    return opponentHand.splice(index, 1)[0];
                } else {
                    // 勝てるカードがない場合、手札の中で最小のカードを選ぶ
                    opponentHand.sort((a, b) => a - b);
                    return opponentHand.splice(0, 1)[0];
                }
            }
        }

        // カードを出す処理
        playCardButton.addEventListener('click', () => {
            if (!isGameActive) {
                messageDisplay.textContent = 'ゲームは終了しました。リセットしてください。';
                return;
            }
            if (selectedPlayerCard === null) {
                messageDisplay.textContent = 'カードを選択してください！';
                return;
            }

            // プレイヤーのカードを手札から削除
            const playerCardIndex = playerHand.indexOf(selectedPlayerCard);
            if (playerCardIndex > -1) {
                playerHand.splice(playerCardIndex, 1);
            }

            // AIのカードを選択
            const opponentCard = getOpponentCard(selectedPlayerCard, aiDifficulty);

            // 場に出されたカードを表示
            playerPlayedCardDisplay.textContent = selectedPlayerCard;
            opponentPlayedCardDisplay.textContent = opponentCard;

            // 勝敗判定とスコア更新
            if (selectedPlayerCard > opponentCard) {
                playerScore++;
                messageDisplay.textContent = 'プレイヤーの勝ち！';
                playerPlayedCardDisplay.classList.add('text-green-400'); // 修正
                opponentPlayedCardDisplay.classList.add('text-red-400');   // 修正
            } else if (opponentCard > selectedPlayerCard) {
                opponentScore++;
                messageDisplay.textContent = 'AIの勝ち！';
                playerPlayedCardDisplay.classList.add('text-red-400');   // 修正
                opponentPlayedCardDisplay.classList.add('text-green-400'); // 修正
            } else {
                messageDisplay.textContent = '引き分け！';
            }
            updateScores();

            // 選択状態をリセット
            selectedPlayerCard = null;
            renderPlayerHand(); // 手札を再描画して、出したカードを消す

            // ゲーム終了判定
            if (playerHand.length === 0) {
                isGameActive = false;
                playCardButton.disabled = true;
                let finalMessage = '';
                if (playerScore > opponentScore) {
                    finalMessage = `ゲーム終了！プレイヤーの勝利です！スコア: ${playerScore} - ${opponentScore}`;
                } else if (opponentScore > playerScore) {
                    finalMessage = `ゲーム終了！AIの勝利です！スコア: ${playerScore} - ${opponentScore}`;
                } else {
                    finalMessage = `ゲーム終了！引き分けです！スコア: ${playerScore} - ${opponentScore}`;
                }
                messageDisplay.textContent = finalMessage;
            }
        });

        // リセットボタンの処理
        resetButton.addEventListener('click', () => {
            initializeGame();
        });

        // AI難易度セレクターの変更を監視
        aiDifficultySelector.addEventListener('change', () => {
            aiDifficulty = aiDifficultySelector.value;
            initializeGame(); // 難易度変更時にゲームをリセット
        });

        // ページロード時にゲームを初期化
        window.onload = initializeGame;
    </script>
</body>
</html>
